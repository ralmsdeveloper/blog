<!DOCTYPE html>
<html lang="pt-BR" class="no-js">
<head>
    <meta charset="utf-8">
    <meta charset="utf-8">

<!-- begin SEO -->
<meta name="robots" content="index, follow">









<title>Dica ApplyConfiguration EFCore &gt;=2.2  Ralms.NET</title>




<meta name="description" content="Fala pessoALL, tudo bem?! 👊Bom essa dica pode lhe ajudar a eliminar uma boa parte de código de sua aplicação, em especial de seu ContextFYI:Esta nova funcionalidade que irei apresentar foi uma das features implementadas e que saiu na versão do EntityFramework Core 2.2.Sem mais delongas vamos ao que interessa, antes do EntityFramework Core 2.2 sair do forno, uma das opções de aplicar as configurações de nossas entidades era da seguinte forma:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        modelBuilder.ApplyConfiguration(new LoginConfiguration());        modelBuilder.ApplyConfiguration(new ClienteConfiguration());        modelBuilder.ApplyConfiguration(new EnderecoConfiguration());        modelBuilder.ApplyConfiguration(new CidadeConfiguration());        modelBuilder.ApplyConfiguration(new ProdutoConfiguration());        modelBuilder.ApplyConfiguration(new EstoqueConfiguration());        modelBuilder.ApplyConfiguration(new ...);    }}What’sPois é, isso é muito doloroso, imagine um sistema complexo, onde existe inúmeras entidades, toda vez que criar uma ter que aplicar manualmente no onModelCreating,.., é bastante chato, e podemos esquecer rss 😏!!!Pois bem, existe uma forma de burlar isso, então teríamos que escrever um pouco de código, mas isso seria uma única vez.public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        ApplyAllConfiguration(            modelBuilder,             typeof(SampleDbContext).Assembly);    }    private void ApplyAllConfiguration(ModelBuilder modelBuilder, Assembly assembly)    {        var mappingTypes = assembly            .GetTypes()            .Where(x =&gt;                !x.IsAbstract                &amp;&amp; x.GetInterfaces()                    .Any(y =&gt;                        y.GetTypeInfo().IsGenericType                        &amp;&amp; y.GetGenericTypeDefinition() == typeof(IEntityTypeConfiguration&lt;&gt;)));        var entityMethod = typeof(ModelBuilder).GetMethods()            .Single(x =&gt; x.Name == &quot;Entity&quot; &amp;&amp;                    x.IsGenericMethod &amp;&amp;                    x.ReturnType.Name == &quot;EntityTypeBuilder`1&quot;);        foreach (var mappingType in mappingTypes)        {            var genericTypeArg = mappingType.GetInterfaces().Single().GenericTypeArguments.Single();            var genericEntityMethod = entityMethod.MakeGenericMethod(genericTypeArg);            var entityBuilder = genericEntityMethod.Invoke(modelBuilder, null);            var mapper = Activator.CreateInstance(mappingType);            mapper.GetType().GetMethod(&quot;Configure&quot;).Invoke(mapper, new[] { entityBuilder });        }    }}Então isso foi resolvidoComo falei anteriormente, na versão EFCore 2.2 saiu uma nova feature que resolve tudo isso, ficou mais clean, pouco código e tudo resolvido, veja que agora tudo faz mais sentido, graças ao ApplyConfigurationsFromAssembly.Exemplo:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        var assembly = typeof(SampleDbContext).Assembly;        modelBuilder.ApplyConfigurationsFromAssembly(assembly);    }}FYI:O método ApplyConfigurationsFromAssembly aceita 2 parâmetros, o primeiro é um Assembly, a partir dele o método fará a varredura das interfaces de configuração via Reflection, o segundo é um predicado onde você pode dizer quais configurações serão aplicadas. Pessoal, fico por aqui #mvp #mvpbr #mvpbuzz #efcore">




<meta name="author" content="Rafael Almeida">

<meta property="og:locale" content="pt_BR">
<meta property="og:site_name" content="Ralms.NET .NETCore EFCore EFCOR31 EntityFrameworkCore ASPNET Core PostgreSQL Kafka Google PubSub REGEX Performance Span<T> Dicas Software Tecnologia Sistemas Distribuidos Mensageria SQL Server Developers Sergipe System>Text.JSON Apply Configuration Deep-Dive EFCore dicas de performance SnakeCase CamelCase PascalCase">
<meta property="og:title" content="Dica ApplyConfiguration EFCore &gt;=2.2">


  <link rel="canonical" href="http://localhost:4000/dica/dicaapplyconfiguration/">
  <meta property="og:url" content="http://localhost:4000/dica/dicaapplyconfiguration/">



  <meta property="og:description" content="Fala pessoALL, tudo bem?! 👊Bom essa dica pode lhe ajudar a eliminar uma boa parte de código de sua aplicação, em especial de seu ContextFYI:Esta nova funcionalidade que irei apresentar foi uma das features implementadas e que saiu na versão do EntityFramework Core 2.2.Sem mais delongas vamos ao que interessa, antes do EntityFramework Core 2.2 sair do forno, uma das opções de aplicar as configurações de nossas entidades era da seguinte forma:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        modelBuilder.ApplyConfiguration(new LoginConfiguration());        modelBuilder.ApplyConfiguration(new ClienteConfiguration());        modelBuilder.ApplyConfiguration(new EnderecoConfiguration());        modelBuilder.ApplyConfiguration(new CidadeConfiguration());        modelBuilder.ApplyConfiguration(new ProdutoConfiguration());        modelBuilder.ApplyConfiguration(new EstoqueConfiguration());        modelBuilder.ApplyConfiguration(new ...);    }}What’sPois é, isso é muito doloroso, imagine um sistema complexo, onde existe inúmeras entidades, toda vez que criar uma ter que aplicar manualmente no onModelCreating,.., é bastante chato, e podemos esquecer rss 😏!!!Pois bem, existe uma forma de burlar isso, então teríamos que escrever um pouco de código, mas isso seria uma única vez.public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        ApplyAllConfiguration(            modelBuilder,             typeof(SampleDbContext).Assembly);    }    private void ApplyAllConfiguration(ModelBuilder modelBuilder, Assembly assembly)    {        var mappingTypes = assembly            .GetTypes()            .Where(x =&gt;                !x.IsAbstract                &amp;&amp; x.GetInterfaces()                    .Any(y =&gt;                        y.GetTypeInfo().IsGenericType                        &amp;&amp; y.GetGenericTypeDefinition() == typeof(IEntityTypeConfiguration&lt;&gt;)));        var entityMethod = typeof(ModelBuilder).GetMethods()            .Single(x =&gt; x.Name == &quot;Entity&quot; &amp;&amp;                    x.IsGenericMethod &amp;&amp;                    x.ReturnType.Name == &quot;EntityTypeBuilder`1&quot;);        foreach (var mappingType in mappingTypes)        {            var genericTypeArg = mappingType.GetInterfaces().Single().GenericTypeArguments.Single();            var genericEntityMethod = entityMethod.MakeGenericMethod(genericTypeArg);            var entityBuilder = genericEntityMethod.Invoke(modelBuilder, null);            var mapper = Activator.CreateInstance(mappingType);            mapper.GetType().GetMethod(&quot;Configure&quot;).Invoke(mapper, new[] { entityBuilder });        }    }}Então isso foi resolvidoComo falei anteriormente, na versão EFCore 2.2 saiu uma nova feature que resolve tudo isso, ficou mais clean, pouco código e tudo resolvido, veja que agora tudo faz mais sentido, graças ao ApplyConfigurationsFromAssembly.Exemplo:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        var assembly = typeof(SampleDbContext).Assembly;        modelBuilder.ApplyConfigurationsFromAssembly(assembly);    }}FYI:O método ApplyConfigurationsFromAssembly aceita 2 parâmetros, o primeiro é um Assembly, a partir dele o método fará a varredura das interfaces de configuração via Reflection, o segundo é um predicado onde você pode dizer quais configurações serão aplicadas. Pessoal, fico por aqui #mvp #mvpbr #mvpbuzz #efcore">





















  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2019-03-05T00:00:00+00:00">














<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Ralms.NET Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="180x180" href="/assets/ico/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/ico/favicon-16x16.png">
<link rel="manifest" href="/assets/ico/site.webmanifest">
<link rel="mask-icon" href="/assets/ico/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->
</head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/">Ralms.NET</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/categories/" >Artigos</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/talks" >Palestras</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  

<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="http://localhost:4000/assets/images/bio.png" alt="Rafael Almeida" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Rafael Almeida</h3>
    
    
      <p class="author__bio" itemprop="description">
        Microsoft MVP, MCP, MCC, Arquiteto de sistemas e apaixonado por C#, Contribuo com projetos no Github. Fundador do Developers Sergipe, Criador e mantenedor do provider EntityFrameworkCore.FirebirdSQL.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Acompanhe em</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> <span itemprop="name">Sergipe-Brasil</span>
        </li>
      

      

      
        <li>
          <a href="mailto:ralms@ralms.net">
            <meta itemprop="email" content="ralms@ralms.net" />
            <i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/ralmsdeveloper" itemprop="sameAs">
            <i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/ralmsdeveloper" itemprop="sameAs">
            <i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      
        <li>
          <a href="https://instagram.com/ralmsdeveloper" itemprop="sameAs">
            <i class="fa fa-fw fa-instagram" aria-hidden="true"></i> Instagram
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://github.com/ralmsdeveloper" itemprop="sameAs">
            <i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fa fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Dica ApplyConfiguration EFCore &gt;=2.2">
    <meta itemprop="description" content="Fala pessoALL, tudo bem?! 👊Bom essa dica pode lhe ajudar a eliminar uma boa parte de código de sua aplicação, em especial de seu ContextFYI:Esta nova funcionalidade que irei apresentar foi uma das features implementadas e que saiu na versão do EntityFramework Core 2.2.Sem mais delongas vamos ao que interessa, antes do EntityFramework Core 2.2 sair do forno, uma das opções de aplicar as configurações de nossas entidades era da seguinte forma:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        modelBuilder.ApplyConfiguration(new LoginConfiguration());        modelBuilder.ApplyConfiguration(new ClienteConfiguration());        modelBuilder.ApplyConfiguration(new EnderecoConfiguration());        modelBuilder.ApplyConfiguration(new CidadeConfiguration());        modelBuilder.ApplyConfiguration(new ProdutoConfiguration());        modelBuilder.ApplyConfiguration(new EstoqueConfiguration());        modelBuilder.ApplyConfiguration(new ...);    }}What’sPois é, isso é muito doloroso, imagine um sistema complexo, onde existe inúmeras entidades, toda vez que criar uma ter que aplicar manualmente no onModelCreating,.., é bastante chato, e podemos esquecer rss 😏!!!Pois bem, existe uma forma de burlar isso, então teríamos que escrever um pouco de código, mas isso seria uma única vez.public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        ApplyAllConfiguration(            modelBuilder,             typeof(SampleDbContext).Assembly);    }    private void ApplyAllConfiguration(ModelBuilder modelBuilder, Assembly assembly)    {        var mappingTypes = assembly            .GetTypes()            .Where(x =&gt;                !x.IsAbstract                &amp;&amp; x.GetInterfaces()                    .Any(y =&gt;                        y.GetTypeInfo().IsGenericType                        &amp;&amp; y.GetGenericTypeDefinition() == typeof(IEntityTypeConfiguration&lt;&gt;)));        var entityMethod = typeof(ModelBuilder).GetMethods()            .Single(x =&gt; x.Name == &quot;Entity&quot; &amp;&amp;                    x.IsGenericMethod &amp;&amp;                    x.ReturnType.Name == &quot;EntityTypeBuilder`1&quot;);        foreach (var mappingType in mappingTypes)        {            var genericTypeArg = mappingType.GetInterfaces().Single().GenericTypeArguments.Single();            var genericEntityMethod = entityMethod.MakeGenericMethod(genericTypeArg);            var entityBuilder = genericEntityMethod.Invoke(modelBuilder, null);            var mapper = Activator.CreateInstance(mappingType);            mapper.GetType().GetMethod(&quot;Configure&quot;).Invoke(mapper, new[] { entityBuilder });        }    }}Então isso foi resolvidoComo falei anteriormente, na versão EFCore 2.2 saiu uma nova feature que resolve tudo isso, ficou mais clean, pouco código e tudo resolvido, veja que agora tudo faz mais sentido, graças ao ApplyConfigurationsFromAssembly.Exemplo:public class SampleDbContext : DbContext{    public SampleDbContext(DbContextOptions&lt;SampleDbContext&gt; options)        : base(options)    {    }    protected override void OnModelCreating(ModelBuilder modelBuilder)    {        var assembly = typeof(SampleDbContext).Assembly;        modelBuilder.ApplyConfigurationsFromAssembly(assembly);    }}FYI:O método ApplyConfigurationsFromAssembly aceita 2 parâmetros, o primeiro é um Assembly, a partir dele o método fará a varredura das interfaces de configuração via Reflection, o segundo é um predicado onde você pode dizer quais configurações serão aplicadas. Pessoal, fico por aqui #mvp #mvpbr #mvpbuzz #efcore">
    <meta itemprop="datePublished" content="March 05, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Dica ApplyConfiguration EFCore &gt;=2.2
</h1>
          
                             <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  7 minuto(s) de leitura
 - March 05, 2019</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fa fa-file-text"></i> Começando</h4></header>
              <ul class="toc__menu">
  <li><a href="#whats">What’s</a></li>
  <li><a href="#então-isso-foi-resolvido">Então isso foi resolvido</a></li>
</ul>
            </nav>
          </aside>
        
        <p><img src="http://localhost:4000/assets/images/dicas/dicaapplyconfiguration.png" alt="01" /></p>

<center><strong>Fala pessoALL, tudo bem?! 👊</strong></center>
<hr />

<p>Bom essa dica pode lhe ajudar a eliminar uma boa parte de código de sua aplicação, em especial de seu <strong>Context</strong>
<br /></p>
<div class="notice--warning">
<strong>FYI:</strong><br />
Esta nova funcionalidade que irei apresentar foi uma das features implementadas e que saiu na versão do EntityFramework Core 2.2.
</div>
<p>Sem mais delongas vamos ao que interessa, antes do EntityFramework Core 2.2 sair do forno, uma das opções de aplicar as configurações de nossas entidades era da seguinte forma:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SampleDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SampleDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">SampleDbContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">LoginConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">ClienteConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">EnderecoConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">CidadeConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">ProdutoConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="nf">EstoqueConfiguration</span><span class="p">());</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfiguration</span><span class="p">(</span><span class="k">new</span> <span class="p">...);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="whats">What’s</h2>

<p>Pois é, isso é muito doloroso, imagine um sistema complexo, onde existe inúmeras entidades, toda vez que criar uma ter que aplicar manualmente no <strong>onModelCreating</strong>,.., é bastante chato, e podemos esquecer rss 😏!!!<br /></p>

<p>Pois bem, existe uma forma de burlar isso, então teríamos que escrever um pouco de código, mas isso seria uma única vez.</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SampleDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SampleDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">SampleDbContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">ApplyAllConfiguration</span><span class="p">(</span>
            <span class="n">modelBuilder</span><span class="p">,</span> 
            <span class="k">typeof</span><span class="p">(</span><span class="n">SampleDbContext</span><span class="p">).</span><span class="n">Assembly</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">ApplyAllConfiguration</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">,</span> <span class="n">Assembly</span> <span class="n">assembly</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">mappingTypes</span> <span class="p">=</span> <span class="n">assembly</span>
            <span class="p">.</span><span class="nf">GetTypes</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span>
                <span class="p">!</span><span class="n">x</span><span class="p">.</span><span class="n">IsAbstract</span>
                <span class="p">&amp;&amp;</span> <span class="n">x</span><span class="p">.</span><span class="nf">GetInterfaces</span><span class="p">()</span>
                    <span class="p">.</span><span class="nf">Any</span><span class="p">(</span><span class="n">y</span> <span class="p">=&gt;</span>
                        <span class="n">y</span><span class="p">.</span><span class="nf">GetTypeInfo</span><span class="p">().</span><span class="n">IsGenericType</span>
                        <span class="p">&amp;&amp;</span> <span class="n">y</span><span class="p">.</span><span class="nf">GetGenericTypeDefinition</span><span class="p">()</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEntityTypeConfiguration</span><span class="p">&lt;&gt;)));</span>


        <span class="kt">var</span> <span class="n">entityMethod</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ModelBuilder</span><span class="p">).</span><span class="nf">GetMethods</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">Single</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"Entity"</span> <span class="p">&amp;&amp;</span>
                    <span class="n">x</span><span class="p">.</span><span class="n">IsGenericMethod</span> <span class="p">&amp;&amp;</span>
                    <span class="n">x</span><span class="p">.</span><span class="n">ReturnType</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"EntityTypeBuilder`1"</span><span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">mappingType</span> <span class="k">in</span> <span class="n">mappingTypes</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">genericTypeArg</span> <span class="p">=</span> <span class="n">mappingType</span><span class="p">.</span><span class="nf">GetInterfaces</span><span class="p">().</span><span class="nf">Single</span><span class="p">().</span><span class="n">GenericTypeArguments</span><span class="p">.</span><span class="nf">Single</span><span class="p">();</span>
            <span class="kt">var</span> <span class="n">genericEntityMethod</span> <span class="p">=</span> <span class="n">entityMethod</span><span class="p">.</span><span class="nf">MakeGenericMethod</span><span class="p">(</span><span class="n">genericTypeArg</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">entityBuilder</span> <span class="p">=</span> <span class="n">genericEntityMethod</span><span class="p">.</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">modelBuilder</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="kt">var</span> <span class="n">mapper</span> <span class="p">=</span> <span class="n">Activator</span><span class="p">.</span><span class="nf">CreateInstance</span><span class="p">(</span><span class="n">mappingType</span><span class="p">);</span>
            <span class="n">mapper</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="nf">GetMethod</span><span class="p">(</span><span class="s">"Configure"</span><span class="p">).</span><span class="nf">Invoke</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="n">entityBuilder</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="então-isso-foi-resolvido">Então isso foi resolvido</h2>
<p>Como falei anteriormente, na versão EFCore 2.2 saiu uma nova feature que resolve tudo isso, ficou mais clean, 
pouco código e tudo resolvido, veja que agora tudo faz mais sentido, graças ao <strong>ApplyConfigurationsFromAssembly</strong>.<br />
Exemplo:</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">SampleDbContext</span> <span class="p">:</span> <span class="n">DbContext</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SampleDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="p">&lt;</span><span class="n">SampleDbContext</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">modelBuilder</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">assembly</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">SampleDbContext</span><span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>
        <span class="n">modelBuilder</span><span class="p">.</span><span class="nf">ApplyConfigurationsFromAssembly</span><span class="p">(</span><span class="n">assembly</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="notice--warning">
<strong>FYI:</strong><br />
O método <strong>ApplyConfigurationsFromAssembly</strong> aceita 2 parâmetros, o primeiro é um <strong>Assembly</strong>, a partir dele o método fará a varredura das interfaces de configuração via <strong>Reflection</strong>, o segundo é um predicado onde você pode dizer quais configurações serão aplicadas.
</div>
<p><br /><br /> 
Pessoal, fico por aqui <strong>#mvp #mvpbr #mvpbuzz #efcore</strong></p>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categorias: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/categories/#dica" class="page__taxonomy-item" rel="tag">Dica</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Atualizado em:</strong> <time datetime="2019-03-05T00:00:00+00:00">March 05, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Compartilhe em</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Dica+ApplyConfiguration+EFCore+%3E%3D2.2%20http%3A%2F%2Flocalhost%3A4000%2Fdica%2Fdicaapplyconfiguration%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Compartilhe em Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdica%2Fdicaapplyconfiguration%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Compartilhe em Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fdica%2Fdicaapplyconfiguration%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Compartilhe em Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fdica%2Fdicaapplyconfiguration%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Compartilhe em LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="http://localhost:4000/retrospectiva/retro2018/" class="pagination--pager" title="Retrospectiva 2018
">Anterior</a>
    
    
      <a href="http://localhost:4000/eventos/mvpconf2019/" class="pagination--pager" title="Deep-Dive On EntityFrameworkCore
">Próxima</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">Talvez você goste também</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/retrospectiva/feliz2020/" rel="permalink">Adeus 2019, bem vindo 2020!
</a>
      
    </h2>
    
    <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  11 minuto(s) de leitura
 - December 31, 2019</p>
    
    <p class="archive__item-excerpt" itemprop="description">

Fala meu amigo(a), tudo bem?!


Agradecimentos

Nossa, que ano foi esse 2019, muitas conquistas e realizações, e antes de começar a escrever minha retrospe...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/dica/performanceregexvsspan/" rel="permalink">Será que o Regex é rápido?
</a>
      
    </h2>
    
    <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  19 minuto(s) de leitura
 - December 07, 2019</p>
    
    <p class="archive__item-excerpt" itemprop="description">

Fala pessoal, tudo bem?!


Curiosidade leva nos sempre a pensar fora da caixa!!!

No artigo SNAKE CASE eu usei um REGEX para aplicar 
a nomenclatura snake-...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/dica/efcore31_operations_interception/" rel="permalink">Interceptando comandos - EF Core 3.1
</a>
      
    </h2>
    
    <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  8 minuto(s) de leitura
 - December 05, 2019</p>
    
    <p class="archive__item-excerpt" itemprop="description">

Fala pessoal, tudo bem?!


Sonho realizado

Você nem imagina o quanto de pessoas esperando por isso, sim, estou falando de uma forma de interceptar toda op...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="http://localhost:4000/dica/snakecase_efcore31/" rel="permalink">Breaking changes - EF Core 3.1
</a>
      
    </h2>
    
    <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 




  17 minuto(s) de leitura
 - December 03, 2019</p>
    
    <p class="archive__item-excerpt" itemprop="description">

Fala pessoal, tudo bem?! 💚


Veja como fazer convenções de nomenclatura SnakeCase de forma fácil para o Entity Framework Core 3.1



FYI:
Este artigo é uma...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
  <input type="text" id="search" class="search-input" tabindex="-1" placeholder="Digite o que está pesquisando..." />
  <div id="results" class="results"></div>
</div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Acompanhe em</strong></li>
    
    
    
    
      <li><a href="https://github.com/ralmsdeveloper"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Rafael Almeida.</div>

      </footer>
    </div>

    
  <script src="http://localhost:4000/assets/js/main.min.js"></script>



  <script src="http://localhost:4000/assets/js/lunr.min.js"></script>
  <script src="http://localhost:4000/assets/js/lunr-en.js"></script>





    
<script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/dica/dicaapplyconfiguration/";
      this.page.identifier = "/dica/dicaapplyconfiguration";
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://ralmsdeveloper.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

  



  </body>
</html>
